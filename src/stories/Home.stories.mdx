import { Meta, Canvas } from '@storybook/addon-docs/blocks';

<Meta title="Home" />

# H5Web Component Library

[H5Web](https://github.com/silx-kit/h5web) is a web-based viewer to explore HDF5 files. It is built with React and uses
[react-three-fiber](https://github.com/react-spring/react-three-fiber) for visualizations.

This library provides data visualization components and utilities from H5Web for use in other front-end web applications.

The components are organised in two categories:

- ðŸŽ¨ **Visualizations**: the top-level visualization components â€” i.e. the components you will most likely need.
- ðŸ§± **Building Blocks**: the low-level components used by the visualization components â€” for advanced uses only.

## Getting started

1. Make you sure you have `react` and `react-dom` v16 or greater installed.
1. Install the library:

   ```bash
   npm install @h5web/lib
   ```

1. Import and use a visualization component:

   ```tsx
   import { ScalarVis } from '@h5web/lib';

   // ...

   <ScalarVis value={1024} />;
   ```

1. Other visualization components expect to receive an `ndarray` and a domain as props.

   1. Install `ndarray` and its corresponding types package (if you use TypeScript):

      ```bash
      npm install ndarray
      npm install --save-dev @types/ndarray
      ```

   1. Pass an `ndarray` and domain to the visualization:

      ```tsx
      import ndarray from 'ndarray';
      import { HeatmapVis, getDomain } from '@h5web/lib';

      // Source 2D array
      const values = [
        [0, 1, 2],
        [3, 4, 5],
      ];

      // Flatten array
      const flatValues: number[] = values.flat(Infinity);

      // Convert to ndarray and get domain
      const dataArray = ndarray<number>(flatValues, [2, 3]);
      const domain = getDomain(dataArray);

      // ...

      <HeatmapVis dataArray={dataArray} domain={domain} />;
      ```

1. Configure the visualization:

   ```tsx
   import { HeatmapVis, getDomain, ScaleType } from '@h5web/lib';

   // ...

   <HeatmapVis
     dataArray={dataArray}
     domain={domain}
     colorMap="Inferno"
     scaleType={ScaleType.Log}
     ...
   />;
   ```

## Mock data

The library exposes a utility function to retrieve a mock entity's metadata and a mock dataset's value as ndarray for testing purposes.
You can browse through the available mock data at https://h5web.panosc.eu/mock.

```ts
import { findMockEntity, getMockDataArray } from '@h5web/lib';

const entity = findMockEntity('/nD_datasets/twoD');
const dataArray = getMockDataArray('/nD_datasets/twoD');
```

## Utilities

The library exposes a number of utility functions, which are documented below, as well as all the enums and types used by these utility functions.
If you use only the top-level visualization components, the only utilities you need are `getDomain` and/or `useDomain`.

#### getDomain

Find the min and max values contained in a array (or ndarray) of numbers. If `scaleType` is `ScaleType.Log` and the domain crosses zero, clamp the min to the first positive value or return `undefined` if the domain is not supported (i.e. `[-x, 0]`).

```ts
getDomain(values: NdArray | number[], scaleType: ScaleType = ScaleType.Linear): Domain | undefined

const linearDomain = getDomain([10, 5, -1]); // [-1, 10]
const logDomain = getDomain([-1, 2, 10], ScaleType.Log); // [2, 10]

const myArray = ndarray([0, 1, 2, 3], [2, 2]);
const myDomain = getDomain(myArray); // [0, 3]
```

#### getDomains

Find the domains of multiple arrays (or ndarrays) of numbers. Useful when dealing with auxiliary curves.

```ts
getDomains(arrays: (NdArray | number[])[], scaleType: ScaleType = ScaleType.Linear): (Domain | undefined)[]

const linearDomains = getDomains([[-1, 5, 10], myArray]); // [[-1, 10], [0, 3]]
const logDomains = getDomains([[-1, 5, 10], myArray], ScaleType.Log); // [[2, 10], [0, 3]]
```

#### getCombinedDomain

Combine multiple domains into one. Useful to find the overall domain of a line visualization with auxiliary curves.

```ts
getCombinedDomain(domains: (Domain | undefined)[]): Domain | undefined

const combinedDomain = getCombinedDomain([[-1, 10], [0, 30]]]); // [-1, 30]
```

#### extendDomain

Extend a domain by a factor in a given scale.

```ts
extendDomain(domain: Domain, extendFactor: number, scaleType: ScaleType = ScaleType.Linear): Domain

const extendedDomain1 = extendDomain([0, 100], 0.5]); // [-50, 150]
const extendedDomain2 = extendDomain([10, 100], 1, ScaleType.Log); // approx. [1, 1000]
const extendedDomain3 = extendDomain([2, 2], 0.5); // [1, 3]
const extendedDomain4 = extendDomain([1, 1], 1, ScaleType.Log); // [0.1, 10]
```

#### computeVisSize

Compute the optimal size for a visualization based on the available size and an aspect ratio. If `aspecRatio` is not provided, `availableSize` is returned unchanged.

```ts
computeVisSize(availableSize: Size, aspectRatio?: number): Size | undefined

const size = computeVisSize({ width: 20, height: 10 }, 1.5); // { width: 15, height: 10 }
```

#### getLinearGradient

Generate a CSS linear gradient for a given D3 interpolator, to be used as `background-image`. If `minMaxOnly` is `true`, the gradient will include only two colours stops.

```ts
getLinearGradient(interpolator: D3Interpolator, direction: 'top' | 'bottom' | 'right' | 'left', minMaxOnly = false): string
```

### Hooks

- **`useDomain(...args): Domain | undefined`** - Memoised version of `getDomain`.
- **`useDomains(...args): (Domain | undefined)[]`** - Memoised version of `getDomains`.
- **`useCombinedDomain(...args): Domain | undefined`** - Memoised version of `getCombinedDomain`.

## Low-level examples

H5Web's low-level building blocks can be composed to create custom visualizations. For instance:

- [Multiple curves](https://codesandbox.io/s/h5webmultiple-curves-kwkli?file=/src/App.tsx)
